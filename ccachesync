#!/bin/bash
#
# Install Extra Packages
cd /tmp
curl -O https://downloads.rclone.org/rclone-current-linux-amd64.zip
unzip rclone-current-linux-amd64.zip
sudo mv rclone-*-linux-amd64/rclone /home/builder/bin/
sudo curl https://raw.githubusercontent.com/fabianonline/telegram.sh/master/telegram -so  /home/builder/bin/telegram
sudo chmod a+x /home/builder/bin/telegram

# Fix TimeZone
sudo ln -snf /usr/share/zoneinfo/Asia/Dhaka /etc/localtime

# Setup Configs
mkdir -p ~/.config/rclone
echo "$rclone_config" > ~/.config/rclone/rclone.conf
echo "$tg_auth" > ~/.telegram.sh

# Notify In telegram
telegram -M "*RR OS Compile Status*: \`TRIGGERED!\`.
*Triggered at*:- \`$(date)\`."

# Pull CCache
cd $CCACHE_DIR
rclone copy remote:/ccache/rrbuildercache $CCACHE_DIR -P
tar -I "zstd -1 -T2" -xf rrbuildercache
rm rrbuildercache

# Push CCache
sleep 100m
tar -I "zstd -1 -T2" -cf rrbuildercache *
rclone copy rrbuildercache remote:/ccache/ -P
